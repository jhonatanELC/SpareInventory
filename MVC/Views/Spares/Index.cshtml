@model IEnumerable<SpareWithBrandToReturn>
@{
   ViewData["Title"] = "Index";
   string[] groups = (string[])ViewData["groups"]!;

}

<div class="main-up">
   <div class="big-icon-container">
      <svg class="big-icons" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M256 80c0-17.7-14.3-32-32-32s-32 14.3-32 32V224H48c-17.7 0-32 14.3-32 32s14.3 32 32 32H192V432c0 17.7 14.3 32 32 32s32-14.3 32-32V288H400c17.7 0 32-14.3 32-32s-14.3-32-32-32H256V80z" /></svg>
      <p><a asp-controller="Spares" asp-action="Create">Nuevo Producto</a></p>
   </div>
   <div class="big-icon-container">
      <svg class="big-icons" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M362.7 19.3L314.3 67.7 444.3 197.7l48.4-48.4c25-25 25-65.5 0-90.5L453.3 19.3c-25-25-65.5-25-90.5 0zm-71 71L58.6 323.5c-10.4 10.4-18 23.3-22.2 37.4L1 481.2C-1.5 489.7 .8 498.8 7 505s15.3 8.5 23.7 6.1l120.3-35.4c14.1-4.2 27-11.8 37.4-22.2L421.7 220.3 291.7 90.3z" /></svg>
      <p>Editar Producto</p>
   </div>
   <div class="big-icon-container">
      <svg class="big-icons" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M135.2 17.7L128 32H32C14.3 32 0 46.3 0 64S14.3 96 32 96H416c17.7 0 32-14.3 32-32s-14.3-32-32-32H320l-7.2-14.3C307.4 6.8 296.3 0 284.2 0H163.8c-12.1 0-23.2 6.8-28.6 17.7zM416 128H32L53.2 467c1.6 25.3 22.6 45 47.9 45H346.9c25.3 0 46.3-19.7 47.9-45L416 128z" /></svg>
      <p>Borrar Producto</p>
   </div>

</div>
<div class="main-down">
   <div class="firstRow">
      <select id="group-dropdown">
         @foreach (var item in groups)
         {
            if (item == ViewBag.CurrentFilterByValue)
            {
               <option value="filterByGroup" selected="selected">@item</option>
            }
            else
            {
               <option value="filterByGroup">@item</option>
            }
         }
      </select>

      <select id="dropdown">
         @foreach (var item in ViewBag.SearchFileds)
         {
            if (item.Key == ViewBag.CurrentSearchBy)
            {
               <option value="@item.Key" selected="selected">@item.Value</option>
            }
            else
            {
               <option value="@item.Key">@item.Value</option>
            }
         }
      </select>

      <input type="text" id="inputField" value="@ViewBag.CurrentSearchValue">
      <button onclick="submitForm()">Submit</button>
      <button>
         <a asp-controller="Spares" asp-action="Index">Borrar</a>

      </button>
   </div>

   <div class="secondRow">
      <table>
         <tr>
            <th>OEM</th>
            <th>Descripción</th>
            <th>Marca</th>
            <th>Código</th>
            <th>Costo</th>
            <th>Moneda</th>
            <th>Venta</th>

            <th></th>
            <th></th>

         </tr>

         @foreach (var spare in Model)
         {
            CultureInfo cultureInfo;

            var brandQuantity = spare.Brands.Count;
            BrandsWithPriceToReturn? brandVm = spare.Brands.FirstOrDefault();
            SpareBrandToReturn? spareBrandVm = brandVm?.SpareBrands.FirstOrDefault();


            cultureInfo = spareBrandVm?.Price.Currency.ToString() == "sol" ?
            new CultureInfo("es-PE") :
            new CultureInfo("en-US");


            if (brandQuantity > 1)
            {
               foreach (var brand in spare.Brands)
               {
                  <tr>
                     <td>@Html.DisplayFor(model => spare.OemCode)</td>
                     <td>@Html.DisplayFor(spares => spare.Description)</td>
                     <td>@Html.Raw(brand.Name)</td>
                     <td>@Html.Raw(brand.SpareBrands[0].CodeByBrand)</td>
                     <td>@Html.Raw(brand.SpareBrands[0].Price.UnitPrice.ToString("C", cultureInfo))</td>
                     <td>@Html.Raw(brand.SpareBrands[0].Price.Currency.ToString())</td>
                     <td>@Html.Raw(brand.SpareBrands[0].Price.SellPrice.ToString("C", cultureInfo))</td>
                     <td style="text-align:center"><a asp-controller="Spares" asp-action="Delete" asp-route-spareId="@spare.SpareId">✖️</a></td>
                     <td style="text-align:center"><a asp-controller="Spares" asp-action="Edit" asp-route-spareId="@spare.SpareId">🖊️</a></td>
                  </tr>
               }
            }
            else
            {
               <tr>
                  <td>@Html.DisplayFor(model => spare.OemCode)</td>
                  <td>@Html.DisplayFor(model => spare.Description)</td>
                  <td>@Html.Raw(brandVm?.Name)  </td> @* @Html.Encode *@
                  <td>@Html.Raw(spareBrandVm?.CodeByBrand)</td>
                  <td>@Html.Raw(spareBrandVm?.Price.UnitPrice.ToString("C", cultureInfo))</td>
                  <td>@Html.Raw(spareBrandVm?.Price.Currency.ToString())</td>
                  <td>@Html.Raw(spareBrandVm?.Price.SellPrice.ToString("C", cultureInfo))</td>
                  <td style="text-align:center"><a asp-controller="Spares" asp-action="Delete" asp-route-spareId="@spare.SpareId">✖️</a></td>
                  <td style="text-align:center"><a asp-controller="Spares" asp-action="Edit" asp-route-spareId="@spare.SpareId">🖊️</a></td>
               </tr>
            }
         }
      </table>
   </div>
</div>


@section scripts {
   <script src="~/js/spareindex.js"></script>
}

